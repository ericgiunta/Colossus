<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Multiple Realization Methods • Colossus</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Multiple Realization Methods">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">Colossus</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.4.7</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Alt_Run_Opt.html">Alternative Regression Options</a></li>
    <li><a class="dropdown-item" href="../articles/Control_Options.html">List of Control Options</a></li>
    <li><a class="dropdown-item" href="../articles/count_time_tables.html">Generating Person-Count and Person-Time Tables</a></li>
    <li><a class="dropdown-item" href="../articles/Dose_Formula_Inputs.html">Dose Response Formula Terms</a></li>
    <li><a class="dropdown-item" href="../articles/Equation_Expression.html">Unified Equation Representation</a></li>
    <li><a class="dropdown-item" href="../articles/Excess_and_Predicted_Cases.html">Excess and Predicted Cases</a></li>
    <li><a class="dropdown-item" href="../articles/Grad_Hess.html">Gradient and Hessian Approaches</a></li>
    <li><a class="dropdown-item" href="../articles/Logistic.html">Logistic Regression</a></li>
    <li><a class="dropdown-item" href="../articles/Matched_Case_Control.html">Matched Case-Control Logistic Regression</a></li>
    <li><a class="dropdown-item" href="../articles/Multi_Realization.html">Multiple Realization Methods</a></li>
    <li><a class="dropdown-item" href="../articles/Plotting_And_Analysis.html">Functions for Plotting and Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/Script_Comparison_Epicure.html">Script comparisons with 32-bit Epicure</a></li>
    <li><a class="dropdown-item" href="../articles/SMR_Analysis.html">SMR Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/Starting-Description.html">Colossus Description</a></li>
    <li><a class="dropdown-item" href="../articles/Time_Dep_Cov.html">Time Dependent Covariate Use</a></li>
    <li><a class="dropdown-item" href="../articles/Wald_and_Log_Bound.html">Confidence Interval Selection</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ericgiunta/Colossus/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Multiple Realization Methods</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ericgiunta/Colossus/blob/main/vignettes/Multi_Realization.Rmd" class="external-link"><code>vignettes/Multi_Realization.Rmd</code></a></small>
      <div class="d-none name"><code>Multi_Realization.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html" class="external-link">Sys.setenv</a></span><span class="op">(</span><span class="st">"OMP_THREAD_LIMIT"</span> <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="co"># Reducing core use, to avoid accidental use of too many cores</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ericgiunta.github.io/Colossus/" class="external-link">Colossus</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="available-methods">Available Methods<a class="anchor" aria-label="anchor" href="#available-methods"></a>
</h2>
<p>There are many instances in which a user may want to use data that is
known up to a distribution, in these cases it may not be sufficient to
use a single realization. Colossus provides two ways to use multiple
realizations. The first runs multiple regressions in a row, each with a
different realization. The second optimizes the average Log-Likelihood
over the realizations. These methods were designed to assist in
circumstances in which combinations of shared and unshared errors are
present, and a two-dimensional Monte Carlo method is used to generate
realizations for at least one covariate column. Note that this method
does not apply to uncertainties in the event/cases or interval/duration
columns.</p>
<div class="section level3">
<h3 id="specifics-of-use">Specifics of Use<a class="anchor" aria-label="anchor" href="#specifics-of-use"></a>
</h3>
<p>Let us suppose that we are interested in performing a regression with
three covariates: an age bin, amount of exposure to a radioisotope
during an interval, and average sleep during an interval. Age bin is
known, exposure is known up to a distribution that could be shared among
individuals, and sleep is randomly distributed and independent in each
interval.</p>
<p class="text-center" style="background-color: aliceblue">
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>λ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>a</mi><mo>,</mo><mi>r</mi><mo>,</mo><mi>s</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>β</mi><mi>a</mi></msub><mo>×</mo><mi>a</mi><mo>+</mo><msub><mi>β</mi><mi>a</mi></msub><mo>×</mo><mi>r</mi><mo>+</mo><msub><mi>β</mi><mi>a</mi></msub><mo>×</mo><mi>s</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{aligned}
    \lambda(a, r, s) = \exp{(\beta_a \times a + \beta_a \times r + \beta_a \times s)}
\end{aligned}
</annotation></semantics></math></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu">Cox</span><span class="op">(</span><span class="va">t0</span>, <span class="va">t1</span>, <span class="va">event</span><span class="op">)</span> <span class="op">~</span> <span class="fu">loglinear</span><span class="op">(</span><span class="va">a</span>, <span class="va">r0</span>, <span class="va">s0</span><span class="op">)</span></span>
<span></span>
<span><span class="va">a_n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span><span class="op">)</span></span></code></pre></div>
<p>Colossus requires two items to apply multiple realizations, a list of
columns to replace, and a matrix of columns for each realization.
Suppose the user generates 5 realizations. Then there are two
distributed columns and five realizations. Similar to other regression
options, Colossus always expects column names listed in the model to be
in the table.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dose_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"r0"</span>, <span class="st">"s0"</span><span class="op">)</span></span>
<span><span class="co"># The two columns in the model to replace are the radiation/sleeping covariates</span></span>
<span><span class="va">dose_realizations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"r0"</span>, <span class="st">"r1"</span>, <span class="st">"r2"</span>, <span class="st">"r3"</span>, <span class="st">"r4"</span>, <span class="st">"s0"</span>, <span class="st">"s1"</span>, <span class="st">"s2"</span>, <span class="st">"s3"</span>, <span class="st">"s4"</span><span class="op">)</span>,</span>
<span>  nrow <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># columns to be used for realizations 0-4, rows for each column being replaced</span></span></code></pre></div>
<p>The first method is designed to perform the Frequentist Model
Averaging method. It runs each regression and returns matrices for the
final parameter estimates, standard deviations, and log-likelihoods/AIC
of each regression. These results can be used to create
likelihood-weighted parameter distributions, to account for uncertainty
in the final parameter estimates. Note that there is no strict
requirement for the realization columns to be realizations of a
distributed column. A user could use this method to compare models with
the same formula but different covariates. The only difficulty is that
Colossus does not refresh the parameter estimates between realization
regressions, so the user may need to keep in mind feasible parameter
space. If individual realizations are being optimized and the initial
parameter estimate is infeasible, the parameter estimates associated
with the negative term are reduced in magnitude. In most cases, this is
enough to find a nearby feasible space to start at.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">e_fma</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CoxRunMulti.html">CoxRunMulti</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">df</span>,</span>
<span>  a_n <span class="op">=</span> <span class="va">a_n</span>,</span>
<span>  realization_columns <span class="op">=</span> <span class="va">realization_columns</span>,</span>
<span>  realization_index <span class="op">=</span> <span class="va">realization_index</span>,</span>
<span>  fma <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The second method is designed to perform the Monte Carlo Maximum
Likelihood method. It returns the standard regression output, only using
the average log-likelihood. Once again, there is no requirement for the
realization columns to be from a distribution. The code could also be
used to determine a set of model parameters that optimize the average
risk from a series of similar models.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">e_mcml</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CoxRunMulti.html">CoxRunMulti</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">df</span>,</span>
<span>  a_n <span class="op">=</span> <span class="va">a_n</span>,</span>
<span>  realization_columns <span class="op">=</span> <span class="va">realization_columns</span>,</span>
<span>  realization_index <span class="op">=</span> <span class="va">realization_index</span>,</span>
<span>  mcml <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Eric Giunta, NASA, NCRP, NRC.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
