<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Script comparisons with 32-bit Epicure • Colossus</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Script comparisons with 32-bit Epicure">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">Colossus</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.4.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Alt_Run_Opt.html">Alternative Regression Options</a></li>
    <li><a class="dropdown-item" href="../articles/Control_Options.html">List of Control Options</a></li>
    <li><a class="dropdown-item" href="../articles/count_time_tables.html">Generating Person-Count and Person-Time Tables</a></li>
    <li><a class="dropdown-item" href="../articles/Dose_Formula_Inputs.html">Dose Response Formula Terms</a></li>
    <li><a class="dropdown-item" href="../articles/Equation_Expression.html">Unified Equation Representation</a></li>
    <li><a class="dropdown-item" href="../articles/Excess_and_Predicted_Cases.html">Excess and Predicted Cases</a></li>
    <li><a class="dropdown-item" href="../articles/Grad_Hess.html">Gradient and Hessian Approaches</a></li>
    <li><a class="dropdown-item" href="../articles/Matched_Case_Control.html">Matched Case-Control Logistic Regression</a></li>
    <li><a class="dropdown-item" href="../articles/Multi_Realization.html">Multiple Realization Methods</a></li>
    <li><a class="dropdown-item" href="../articles/Plotting_And_Analysis.html">Functions for Plotting and Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/Script_Comparison_Epicure.html">Script comparisons with 32-bit Epicure</a></li>
    <li><a class="dropdown-item" href="../articles/SMR_Analysis.html">SMR Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/Starting-Description.html">Colossus Description</a></li>
    <li><a class="dropdown-item" href="../articles/Time_Dep_Cov.html">Time Dependent Covariate Use</a></li>
    <li><a class="dropdown-item" href="../articles/Wald_and_Log_Bound.html">Confidence Interval Selection</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ericgiunta/Colossus/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Script comparisons with 32-bit Epicure</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ericgiunta/Colossus/blob/main/vignettes/Script_Comparison_Epicure.Rmd" class="external-link"><code>vignettes/Script_Comparison_Epicure.Rmd</code></a></small>
      <div class="d-none name"><code>Script_Comparison_Epicure.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ericgiunta.github.io/Colossus/" class="external-link">Colossus</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Note: From versions 1.3.1 to 1.4.1 the expected inputs changed. Regressions are now run with CoxRun and PoisRun and formula inputs. Please see the 'Unified Equation Representation' vignette for more details.</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">parallel</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction-to-colossus">Introduction to Colossus<a class="anchor" aria-label="anchor" href="#introduction-to-colossus"></a>
</h2>
<p>Colossus was developed in the context of radiation epidemiologists
wanting to use new methods and more data. At the time of development,
32-bit Epicure was a popular software for running radiation
epidemiological analysis. This vignette was written with that in mind to
help any transitioning users see how the two are similar and different,
in addition to providing guidance for converting between the two. The
script provided will discuss both Colossus-specific differences as well
as general R capabilities that differ from Epicure.</p>
<div class="section level3">
<h3 id="example-epicure-analysis">Example Epicure Analysis<a class="anchor" aria-label="anchor" href="#example-epicure-analysis"></a>
</h3>
<p>The following peanuts script was used as part of validation efforts
for Colossus. The script runs three regressions. A linear excess
relative risk model, a log-linear hazard ratio model for dose overall,
and a log-linear hazard ratio model for categorical bins of dose.
Similar regressions were performed with radiation cohort data to assess
the relationship between the risk of different mortality events and
cumulative radiation exposure to organs.</p>
<p>The script starts by loading the dataset. In this example, we assume
there is a file called “EX_DOSE.csv” in the local directory.</p>
<pre><code>RECORDS 4100000 @
WSOPT VARMAX 30 @
USETXT EX_DOSE.csv @
INPUT @</code></pre>
<p>Next, the script sets the interval start column and interval end
column, and designates which columns have multiple levels.</p>
<pre><code>ENTRY age_entry @
EXIT age_exit @
EVENT nonCLL @

levels SES_CAT YOB_CAT sexm dose_cat @</code></pre>
<p>Past this point, the script specifies which columns belong to each
subterm and term number. In this case, the model has a product-linear
element in the first term. The script additionally sets the convergence
options. The maximum iterations are set to 100 and the convergence
criteria are set to 1e-9. The regression is also set to print deviance
and parameter estimates for each iteration and to print the final
parameter estimates and covariance after the regression concludes.</p>
<pre><code>LOGLINEAR 0 SES_CAT YOB_CAT sexm @
PLINEAR 0 cumulative_dose @

FITOPT P V ITER 100 CONV -9 @</code></pre>
<p>Finally, the regression is run and results are printed to the
console.</p>
<pre><code>FIT @</code></pre>
<p>Past this point, the same general process is followed for the two
hazard ratio regressions. The model definition is reset, the
subterm/term description is set, and the regression is run.</p>
<pre><code>NOMODEL @

LOGLINEAR 0 SES_CAT YOB_CAT sexm cumulative_dose @

FIT @

NOMODEL @

LOGLINEAR 0 SES_CAT YOB_CAT sexm dose_cat @

FIT @</code></pre>
</div>
<div class="section level3">
<h3 id="colossus-script">Colossus Script<a class="anchor" aria-label="anchor" href="#colossus-script"></a>
</h3>
<p>For the most part, the same steps are performed in Colossus. The
script starts by reading the input file. The only difference is that R
does not require memory to be set aside before reading the file.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_Dose</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/fread.html" class="external-link">fread</a></span><span class="op">(</span><span class="st">"EX_DOSE.csv"</span><span class="op">)</span></span></code></pre></div>
<p>Colossus defines the model as a formula. The left-hand side of the
formula defines the type of model, the time observed, and the event
columns. The right-hand side defines the risk factors in each term and
subterm. The model is a Cox regression, the intervals are defined by the
age_entry/age_exit columns, and the event status is stored in the nonCLL
column. This is denoted by ‘Cox(age_entry, age_exit, nonCLL)’. The
loglinear and product-linear subterms are added to the formula by
specifying the subterm type, included columns, and term number,
i.e. ‘subterm(column 1, column 2, …, term number)’. Factored columns are
added by using ‘factor(column)’, the default level is assumed to be the
first level.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_ERR</span> <span class="op">&lt;-</span> <span class="fu">Cox</span><span class="op">(</span><span class="va">age_entry</span>, <span class="va">age_exit</span>, <span class="va">nonCLL</span><span class="op">)</span> <span class="op">~</span> <span class="fu">plinear</span><span class="op">(</span><span class="va">cumulative_dose</span>, <span class="fl">0</span><span class="op">)</span> <span class="op">+</span> <span class="fu">loglinear</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">SES_CAT</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">YOB_CAT</span><span class="op">)</span>, <span class="va">sexm</span><span class="op">)</span></span></code></pre></div>
<p>Next, the script defines the control information. The “control”
variable serves a similar purpose as the “FITOPT” option in Epicure.
This control list specifies that two cores should be used to perform
calculations in parallel, up to 100 iterations should be used, and the
iterations should stop if the step size is below 1e-9 or the first
derivatives are all below 1e-9. The verbose options specifies that any
errors or warnings should be printed to the console.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">control</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Ncores"</span> <span class="op">=</span> <span class="fl">2</span>, <span class="st">"maxiter"</span> <span class="op">=</span> <span class="fl">100</span>, <span class="st">"verbose"</span> <span class="op">=</span> <span class="fl">2</span>, <span class="st">"epsilon"</span> <span class="op">=</span> <span class="fl">1e-9</span>, <span class="st">"der_epsilon"</span> <span class="op">=</span> <span class="fl">1e-9</span><span class="op">)</span></span></code></pre></div>
<p>Finally, the regression is run and a list of the results is returned
to a variable “e”. Regressions in Colossus return a list of results, a
summary can be printed.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">e</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CoxRun.html">CoxRun</a></span><span class="op">(</span><span class="va">model_ERR</span>, <span class="va">df_dose</span>, control <span class="op">=</span> <span class="va">control</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">e</span><span class="op">)</span></span></code></pre></div>
<p>A similar process is run for the two hazard ratio regressions.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># HR</span></span>
<span><span class="va">model_HR</span> <span class="op">&lt;-</span> <span class="fu">Cox</span><span class="op">(</span><span class="va">age_entry</span>, <span class="va">age_exit</span>, <span class="va">nonCLL</span><span class="op">)</span> <span class="op">~</span> <span class="fu">loglinear</span><span class="op">(</span><span class="va">cumulative_dose</span>, <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">SES_CAT</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">YOB_CAT</span><span class="op">)</span>, <span class="va">sexm</span><span class="op">)</span></span>
<span><span class="va">e</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CoxRun.html">CoxRun</a></span><span class="op">(</span><span class="va">model_HR</span>, <span class="va">df_dose</span>, control <span class="op">=</span> <span class="va">control</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">e</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Categorical</span></span>
<span><span class="va">model_categ</span> <span class="op">&lt;-</span> <span class="fu">Cox</span><span class="op">(</span><span class="va">age_entry</span>, <span class="va">age_exit</span>, <span class="va">nonCLL</span><span class="op">)</span> <span class="op">~</span> <span class="fu">loglinear</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">dose_cat</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">SES_CAT</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">YOB_CAT</span><span class="op">)</span>, <span class="va">sexm</span><span class="op">)</span></span>
<span><span class="va">e</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CoxRun.html">CoxRun</a></span><span class="op">(</span><span class="va">model_categ</span>, <span class="va">df_dose</span>, control <span class="op">=</span> <span class="va">control</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">e</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Eric Giunta, NASA, NCRP, NRC.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
