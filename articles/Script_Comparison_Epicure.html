<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Script comparisons with 32-bit Epicure • Colossus</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Script comparisons with 32-bit Epicure">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">Colossus</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.5</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Alt_Distrib_Starts.html">Distributed Start Framework</a></li>
    <li><a class="dropdown-item" href="../articles/Alt_Run_Opt.html">Alternative Regression Options</a></li>
    <li><a class="dropdown-item" href="../articles/Control_Options.html">List of Control Options</a></li>
    <li><a class="dropdown-item" href="../articles/count_time_tables.html">Generating Person-Count and Person-Time Tables</a></li>
    <li><a class="dropdown-item" href="../articles/Dose_Formula_Inputs.html">Dose Response Formula Terms</a></li>
    <li><a class="dropdown-item" href="../articles/Equation_Expression.html">Unified Equation Representation</a></li>
    <li><a class="dropdown-item" href="../articles/Excess_and_Predicted_Cases.html">Excess and Predicted Cases</a></li>
    <li><a class="dropdown-item" href="../articles/Grad_Hess.html">Gradient and Hessian Approaches</a></li>
    <li><a class="dropdown-item" href="../articles/Multi_Realization.html">Multiple Realization Methods</a></li>
    <li><a class="dropdown-item" href="../articles/Plotting_And_Analysis.html">Functions for Plotting and Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/Script_Comparison_Epicure.html">Script comparisons with 32-bit Epicure</a></li>
    <li><a class="dropdown-item" href="../articles/SMR_Analysis.html">SMR Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/Starting-Description.html">Colossus Description</a></li>
    <li><a class="dropdown-item" href="../articles/Time_Dep_Cov.html">Time Dependent Covariate Use</a></li>
    <li><a class="dropdown-item" href="../articles/Wald_and_Log_Bound.html">Confidence Interval Selection</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ericgiunta/Colossus/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Script comparisons with 32-bit Epicure</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ericgiunta/Colossus/blob/main/vignettes/Script_Comparison_Epicure.Rmd" class="external-link"><code>vignettes/Script_Comparison_Epicure.Rmd</code></a></small>
      <div class="d-none name"><code>Script_Comparison_Epicure.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ericgiunta.github.io/Colossus/" class="external-link">Colossus</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">parallel</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction-to-colossus">Introduction to Colossus<a class="anchor" aria-label="anchor" href="#introduction-to-colossus"></a>
</h2>
<p>Colossus was developed in the context of radiation epidemiologists
wanting to use new methods and more data. At the time of development,
32-bit Epicure was a popular software for running radiation
epidemiological analysis. This vignette was written with that in mind to
help any transitioning users see how the two are similar and different,
in addition to providing guidance for converting between the two. The
script provided will discuss both Colossus-specific differences as well
as general R capabilities that differ from Epicure.</p>
<div class="section level3">
<h3 id="example-epicure-analysis">Example Epicure Analysis<a class="anchor" aria-label="anchor" href="#example-epicure-analysis"></a>
</h3>
<p>The following peanuts script was used as part of validation efforts
for Colossus. The script runs three regressions. A linear excess
relative risk model, a log-linear hazard ratio model for dose overall,
and a log-linear hazard ratio model for categorical bins of dose.</p>
<p>The script starts by loading the dataset. In this example we assume
there is a file called “EX_DOSE.csv” in the local directory.</p>
<pre><code>RECORDS 4100000 @
WSOPT VARMAX 30 @
USETXT EX_DOSE.csv @
INPUT @</code></pre>
<p>Next the script sets the interval start column, interval end column,
and designates which columns have multiple levels.</p>
<pre><code>ENTRY age_entry @
EXIT age_exit @
EVENT nonCLL @

levels SES_CAT YOB_CAT sexm dose_cat @</code></pre>
<p>Past this point the script specifies which columns belong to each
subterm and term number. In this case the model has a linear element in
the second term. The script additionally sets the convergence options.
In this case the maximum iterations are set to 100 and the convergence
criteria is set to 1e-9. The regression is also set to print deviance
and parameter estimate each iteration, and to print the final estimates
and covariance after the regression concludes.</p>
<pre><code>LOGLINEAR 0 SES_CAT YOB_CAT sexm @
LINEAR 1 cumulative_dose @

FITOPT P V ITER 100 CONV -9 @</code></pre>
<p>Finally the regression is run and results are printed to the
console.</p>
<pre><code>FIT @</code></pre>
<p>Past this point the same general process is followed for the two
hazard ratio regressions. The model definition is reset, the
subterm/term description is set, and the regression is run.</p>
<pre><code>NOMODEL @

LOGLINEAR 0 SES_CAT YOB_CAT sexm cumulative_dose @

FIT @

NOMODEL @

LOGLINEAR 0 SES_CAT YOB_CAT sexm dose_cat @

FIT @

NOMODEL @</code></pre>
</div>
<div class="section level3">
<h3 id="colossus-script">Colossus Script<a class="anchor" aria-label="anchor" href="#colossus-script"></a>
</h3>
<p>For the most part, the same steps are performed in Colossus. The
script starts off by reading the input file. The only difference is that
R does not require memory to be set aside prior to reading the file.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_Dose</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/data.table/man/fread.html" class="external-link">fread</a></span><span class="op">(</span><span class="st">"EX_DOSE.csv"</span><span class="op">)</span></span></code></pre></div>
<p>The next step defines covariates with levels and assigns the
interval/event column information. The main difference is that Colossus
currently does not automatically split factored columns. So the first
several lines transform the dataset to include factored columns, and
later on the user has to list all of the factored columns.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">col_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SES_CAT"</span>, <span class="st">"YOB_CAT"</span>, <span class="st">"dose_cat"</span><span class="op">)</span></span>
<span><span class="va">val</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/factorize.html">factorize</a></span><span class="op">(</span><span class="va">df_Dose</span>, <span class="va">col_list</span><span class="op">)</span></span>
<span><span class="va">df_Dose</span> <span class="op">&lt;-</span> <span class="va">val</span><span class="op">$</span><span class="va">df</span></span>
<span></span>
<span><span class="va">t0</span> <span class="op">&lt;-</span> <span class="st">"age_entry"</span></span>
<span><span class="va">t1</span> <span class="op">&lt;-</span> <span class="st">"age_exit"</span></span>
<span><span class="va">event</span> <span class="op">&lt;-</span> <span class="st">"nonCLL"</span></span></code></pre></div>
<p>Next the script defines the model and control information. Colossus
stores the model information like columns in a table. So it expects
lists of column names, subterm types, term numbers, etc. In this case
the only non-default values are the column names and subterm types. The
“control” variable serves a similar purpose as the “FITOPT” option in
Epicure.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ERR</span></span>
<span><span class="va">names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cumulative_dose"</span>, <span class="st">"SES_CAT_1"</span>, <span class="st">"SES_CAT_2"</span>, <span class="st">"YOB_CAT_1"</span>, <span class="st">"YOB_CAT_2"</span>, <span class="st">"YOB_CAT_3"</span>, <span class="st">"YOB_CAT_4"</span>, <span class="st">"sexm"</span><span class="op">)</span></span>
<span><span class="va">tform</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"plin"</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"loglin"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">names</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">control</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Ncores"</span> <span class="op">=</span> <span class="fl">8</span>, <span class="st">"maxiter"</span> <span class="op">=</span> <span class="fl">50</span>, <span class="st">"verbose"</span> <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span></code></pre></div>
<p>Finally the regression is run, and a list of the results is returned
to a variable “e”.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">e</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/RunCoxRegression.html">RunCoxRegression</a></span><span class="op">(</span><span class="va">df_Dose</span>, <span class="va">t0</span>, <span class="va">t1</span>, <span class="va">event</span>, <span class="va">names</span>, tform <span class="op">=</span> <span class="va">tform</span>, control <span class="op">=</span> <span class="va">control</span><span class="op">)</span></span></code></pre></div>
<p>A similar process is run for the two hazard ratio regressions.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># HR</span></span>
<span><span class="va">names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cumulative_dose"</span>, <span class="st">"SES_CAT_1"</span>, <span class="st">"SES_CAT_2"</span>, <span class="st">"YOB_CAT_1"</span>, <span class="st">"YOB_CAT_2"</span>, <span class="st">"YOB_CAT_3"</span>, <span class="st">"YOB_CAT_4"</span>, <span class="st">"sexm"</span><span class="op">)</span></span>
<span><span class="va">tform</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"loglin"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">names</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">e</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/RunCoxRegression.html">RunCoxRegression</a></span><span class="op">(</span><span class="va">df_Dose</span>, <span class="va">t0</span>, <span class="va">t1</span>, <span class="va">event</span>, <span class="va">names</span>, tform <span class="op">=</span> <span class="va">tform</span>, control <span class="op">=</span> <span class="va">control</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Categorical</span></span>
<span><span class="va">names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"dose_cat_1"</span>, <span class="st">"dose_cat_2"</span>, <span class="st">"dose_cat_3"</span>, <span class="st">"dose_cat_4"</span>, <span class="st">"dose_cat_5"</span>, <span class="st">"dose_cat_6"</span>, <span class="st">"SES_CAT_1"</span>, <span class="st">"SES_CAT_2"</span>, <span class="st">"YOB_CAT_1"</span>, <span class="st">"YOB_CAT_2"</span>, <span class="st">"YOB_CAT_3"</span>, <span class="st">"YOB_CAT_4"</span>, <span class="st">"sexm"</span><span class="op">)</span></span>
<span><span class="va">tform</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"loglin"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">names</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">e</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/RunCoxRegression.html">RunCoxRegression</a></span><span class="op">(</span><span class="va">df_Dose</span>, <span class="va">t0</span>, <span class="va">t1</span>, <span class="va">event</span>, <span class="va">names</span>, tform <span class="op">=</span> <span class="va">tform</span>, control <span class="op">=</span> <span class="va">control</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Eric Giunta, NASA, NCRP, NRC.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
