<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Colossus">
<title>Colossus_Description • Colossus</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Colossus_Description">
<meta property="og:description" content="Colossus">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">Colossus</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.9.6</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Alt_Distrib_Starts.html">Distributed_Start_Framework</a>
    <a class="dropdown-item" href="../articles/Alt_Run_opt.html">Alternative_Regression_Options</a>
    <a class="dropdown-item" href="../articles/Time_Dep_Cov.html">Time_Dependent_Covariate_Use</a>
    <a class="dropdown-item" href="../articles/dose_formula_inputs.html">Dose_Response_Formula_Terms</a>
    <a class="dropdown-item" href="../articles/starting-description.html">Colossus_Description</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ericgiunta/Colossus/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Colossus_Description</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ericgiunta/Colossus/blob/HEAD/vignettes/starting-description.Rmd" class="external-link"><code>vignettes/starting-description.Rmd</code></a></small>
      <div class="d-none name"><code>starting-description.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ericgiunta/Colossus" class="external-link">Colossus</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">parallel</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="colossus-description">Colossus Description<a class="anchor" aria-label="anchor" href="#colossus-description"></a>
</h2>
</div>
<div class="section level2">
<h2 id="model-structure">Model Structure<a class="anchor" aria-label="anchor" href="#model-structure"></a>
</h2>
<p>At its full potential, Colossus is able to analyze a vast number of
possible risk/rate models. Specifically Colossus is designed to allow
for a combination of linear and non-linear models to estimate cox
proportional hazard ratios, Poisson model rates, and Fine-Grey Competing
risks ratios. The simplest of which is a exponential model. The simplest
model generally used for hazard ratios in survival analysis is the
exponential of a linear function of covariates.</p>
<p class="text-center" style="background-color: aliceblue">
<span class="math display">\[
\begin{aligned}
    R(\vec{\beta},\vec{x})=\exp(\vec{\beta} \cdot \vec{x})
\end{aligned}
\]</span>
</p>
<p>In Colossus, this general model is extended by abstracting to the sum
and product of terms and subterms. In this vignette, the value
calculated to quantify the risk of an event will be denoted as the risk,
R, however the exact meaning differs. In Cox proportional hazard
modeling, the risk calculated is a hazard ratio. In poisson modeling the
risk calculated is an estimated number of events per person-year. The
risk (<span class="math inline">\(R\)</span>) has a set formula
dependent on terms (<span class="math inline">\(T\)</span>). Each term
has a formula dependent on the product of subterms (<span class="math inline">\(S\)</span>). Each subterm is a function of a
single covariate (<span class="math inline">\(x\)</span>) and several
parameters (<span class="math inline">\(\alpha,\beta\)</span>).</p>
<p>There are currently five types of risk models available. The risk can
be expressed as an additive model (<span class="math inline">\(R_A\)</span>), product additive model (<span class="math inline">\(R_{PA}\)</span>), Product additive excess model
(<span class="math inline">\(R_{PAE}\)</span>), multiplicative excess
model (<span class="math inline">\(R_M\)</span>), or the geometric
mixture model with relative risks or excess risks (<span class="math inline">\(R_{GMIX}\)</span>).</p>
<p class="text-center" style="background-color: aliceblue">
<span class="math display">\[
\begin{aligned}
    R_{A}= \sum_{i=0}^n T_i\\
    R_{PA}= T_0 \times \sum_{i=1}^n T_i\\
    R_{PAE}= T_0 \times (1 + \sum_{i=1}^n T_i)\\
    R_{M}= T_0 \times \prod_{i=1}^n( 1 + T_i)\\
    R_{GMIX} = T_0 \times \left(\prod_{i=1}^n(T^{*}_i) \right) ^ \theta
\times \left( 1 + \sum_{i=1}^n (T^{*}_i - 1) \right)^{1-\theta}\\
    T^{*}_i = \begin{cases} T_i &amp;\text{Relative Risk} \\ T_i+1
&amp;\text{Excess Risk} \end{cases}\\
\end{aligned}
\]</span>
</p>
<p>Each term is composed of a combination of 4 types of subterms. Every
covariate is part of a log-linear subterm, a linear subterm, a
product-linear subterm, or a general non-linear term. The log-linear
subterm (<span class="math inline">\(S_{ll}\)</span>) is the exponential
of a linear combination of covariates. The linear subterm (<span class="math inline">\(S_l\)</span>) is a linear combination of
covariates. The product-linear subterm (<span class="math inline">\(S_{PL}\)</span>) is one plus a linear combination
of covariates. The general non-linear term (<span class="math inline">\(S_{NL}\)</span>) is the sum of exponential terms,
quadratic terms, linear-threshold terms (<span class="math inline">\(F_{LT}\)</span>), step function terms (<span class="math inline">\(F_{STP}\)</span>), linear-quadratic terms (<span class="math inline">\(F_{LQ}\)</span>), and linear-exponential terms
(<span class="math inline">\(F_{LEXP}\)</span>). Each term is the
product of the non-empty subterms.</p>
<p class="text-center" style="background-color: aliceblue">
<span class="math display">\[
\begin{aligned}
    S_{LL}=\prod_{i} (\exp{(x_i \cdot \beta_i)})\\
    S_{L}=\sum_i (x_i \cdot \beta_i)\\
    S_{PL}=1+ \sum (x_i \cdot \beta_i)\\
    S_{NL}=\sum_i (\alpha_i \times \exp(x_i \cdot \beta_i)) + \sum_i
(\beta_i \cdot (x_i)^2) + \sum_i F_{LT} + \sum_i F_{STP} + \sum_i F_{LQ}
+ \sum_i F_{LEXP}\\
    F_{LT} = \begin{cases} \alpha_i \cdot (x-\beta_i) &amp;
(x&gt;\beta_i) \\ 0 &amp;\text{else} \end{cases}\\
    F_{STP} = \begin{cases} \alpha_i &amp; (x&gt;\beta_i) \\ 0
&amp;\text{else} \end{cases}\\
    F_{LQ} = \begin{cases} \beta_i \cdot x &amp; (x&gt;\alpha_i) \\
\lambda_i \cdot x^2 + \nu_i &amp;\text{else} \end{cases}\\
    F_{LEXP} = \begin{cases} \beta_i \cdot x &amp; (x&gt;\alpha_i) \\
\lambda_i - \exp{(\nu_i + \mu \cdot x)} &amp;\text{else} \end{cases}\\
    T_j=S_{LL,j} \times S_{L,j} \times S_{PL,j} \times S_{NL,j}
\end{aligned}
\]</span>
</p>
<p>In short, every element of the risk model has a subterm type, term
number, covariate, and parameter value.</p>
</div>
<div class="section level2">
<h2 id="using-the-standard-model">Using The Standard Model<a class="anchor" aria-label="anchor" href="#using-the-standard-model"></a>
</h2>
<p>In Colossus every equation is defined in a very similar fashion. On
the user side of the code, elements of the risk equation can be viewed
as rows of a table. The columns store covariate names, term numbers,
subterms types, and a starting point. For more complex regression most
parameters can be also be set to remain constant over the regression.
Doing so forces the parameter value to remain constant but not remove
the element from the risk calculations. Constant elements are used for
risk calculation, but are not used for calculating steps or standard
deviations. For a multiplicative excess risk model the following table
and equation are equivalent.</p>
<table class="table">
<thead><tr class="header">
<th align="center">Term number</th>
<th align="center">subterm type</th>
<th align="center">covariate</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">0</td>
<td align="center">LogLinear</td>
<td align="center">a</td>
</tr>
<tr class="even">
<td align="center">1</td>
<td align="center">Linear</td>
<td align="center">b</td>
</tr>
<tr class="odd">
<td align="center">1</td>
<td align="center">Linear</td>
<td align="center">c</td>
</tr>
</tbody>
</table>
<p class="text-center" style="background-color: aliceblue">
<span class="math display">\[
\begin{aligned}
    R = \exp{(\beta_{a} \cdot x_{a})} \times (1+\beta_{b} \cdot x_{b} +
\beta_{c} \cdot x_{c})
\end{aligned}
\]</span>
</p>
<p>If the user wanted to update the model to include a new term with a
product-linear subterm, then the table would only need to be updated
with a new row.</p>
<table class="table">
<thead><tr class="header">
<th align="center">Term number</th>
<th align="center">subterm type</th>
<th align="center">covariate</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">0</td>
<td align="center">LogLinear</td>
<td align="center">a</td>
</tr>
<tr class="even">
<td align="center">1</td>
<td align="center">Linear</td>
<td align="center">b</td>
</tr>
<tr class="odd">
<td align="center">1</td>
<td align="center">Linear</td>
<td align="center">c</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">Product-Linear</td>
<td align="center">d</td>
</tr>
</tbody>
</table>
<p class="text-center" style="background-color: aliceblue">
<span class="math display">\[
\begin{aligned}
    R = \exp{(\beta_{a} \cdot x_{a})} \times (1 + (\beta_{b} \cdot x_{b}
+ \beta_{c} \cdot x_{c}) \times (1 + \beta_{d} \cdot x_{d}))
\end{aligned}
\]</span>
</p>
<p>Note that the multiplicative model is taking the product of terms,
each of which is the product of subterms. The same equation may be
written with subterms distributed over different terms in the
multiplicative model without changing the final value. The only
exception is subterms moved from or into the “first” term in the
multiplicative excess model. The same equation could be expressed in
ways with different computational complexity.</p>
<p>The specific model options are passed to the code as separate
variables. The model identifier (A, M, PA, PAE, GMIX) is passed as a
string. Every model except the additive model has a distinction between
the first and remaining terms. Colossus defaults to term 0 being the
unique term, however it can be set to any used term number without
producing an error.</p>
<p>The final table is also equivalent to the following code</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'a'</span>,<span class="st">'b'</span>,<span class="st">'c'</span>,<span class="st">'d'</span><span class="op">)</span></span>
<span><span class="va">Term_n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">tform</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"loglin"</span>,<span class="st">"lin"</span>,<span class="st">"lin"</span>,<span class="st">"plin"</span><span class="op">)</span></span>
<span><span class="va">modelform</span> <span class="op">&lt;-</span> <span class="st">"M"</span></span>
<span><span class="va">fir</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span></span>
<span><span class="va">a_n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span><span class="op">)</span></span></code></pre></div>
<p><em>names</em> denotes the column names used, <em>Term_n</em> denotes
the term numbers, <em>tform</em> denotes the subterm formula,
<em>modelform</em> denotes the term formula, <em>fir</em> denotes the
“first” term indexed from zero which defaults to 0, and <em>a_n</em>
denotes the initial guesses for the parameter values. All of which are
assumed to be in the same order. A function is called prior to
regression that reorders the inputs in order of terms, subterm types,
etc.</p>
</div>
<div class="section level2">
<h2 id="survival-time-and-event-data">Survival Time and Event Data<a class="anchor" aria-label="anchor" href="#survival-time-and-event-data"></a>
</h2>
<p>Colossus performs survival analysis via either a Cox Proportional
Hazards regression or a Poisson regression. In both cases the user
specifies which columns contain time duration and events of interest.
For the Poisson regression these would be which column contains the
person-years and number of events for each row of data. For the Cox
Proportional Hazards regression the user identifies which columns
provide starting and ending times, and what column gives the event
status. The event status is assumed to be a binary covariate which is 1
for intervals containing an event. Colossus supports left censored data,
right censored data, and interval censored data. The data is interval
censored by default, so left and right censoring are handled by defining
interval endpoints outside the minimum or maximum event times. For
Poisson regression the user only provides columns for the person-years
per row and number of events. Poisson regression supports any
non-negative number of events.</p>
<p>On the user side, the names of columns containing the time and events
need to be given. Lets assume we have a dataframe organized as
follows:</p>
<table class="table">
<thead><tr class="header">
<th align="center">UserID</th>
<th align="center">Starting_Age</th>
<th align="center">Ending_Age</th>
<th align="center">Cancer_Status</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">112</td>
<td align="center">18</td>
<td align="center">30</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center">114</td>
<td align="center">20</td>
<td align="center">45</td>
<td align="center">0</td>
</tr>
<tr class="odd">
<td align="center">213</td>
<td align="center">18</td>
<td align="center">57</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">…</td>
<td align="center">…</td>
<td align="center">…</td>
<td align="center">…</td>
</tr>
</tbody>
</table>
<p>For a Cox Proportional Hazard we need to provide three column names:
the starting age, the ending age, and if an event happened during the
interval. In this case that would be “Starting_Age”, “Ending_Age”, and
“Cancer_Status”. In this example we have interval data, however that may
not always be the case. Colossus is designed to allow for the user to
input “%trunc%” in-place of a missing side of the interval. Colossus
assumes that this means that the person has the missing endpoint outside
of the available data range and creates a dummy column to reference as
the interval endpoint. So in code these variables would look like
this:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span><span class="st">"UserID"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">112</span>, <span class="fl">114</span>, <span class="fl">213</span>, <span class="fl">214</span>, <span class="fl">115</span>, <span class="fl">116</span>, <span class="fl">117</span><span class="op">)</span>,</span>
<span>           <span class="st">"Starting_Age"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">18</span>,  <span class="fl">20</span>,  <span class="fl">18</span>,  <span class="fl">19</span>,  <span class="fl">21</span>,  <span class="fl">20</span>,  <span class="fl">18</span><span class="op">)</span>,</span>
<span>             <span class="st">"Ending_Age"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">30</span>,  <span class="fl">45</span>,  <span class="fl">57</span>,  <span class="fl">47</span>,  <span class="fl">36</span>,  <span class="fl">60</span>,  <span class="fl">55</span><span class="op">)</span>,</span>
<span>          <span class="st">"Cancer_Status"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,   <span class="fl">0</span>,   <span class="fl">1</span>,   <span class="fl">0</span>,   <span class="fl">1</span>,   <span class="fl">0</span>,   <span class="fl">0</span><span class="op">)</span>,</span>
<span>                      <span class="st">"a"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,   <span class="fl">1</span>,   <span class="fl">1</span>,   <span class="fl">0</span>,   <span class="fl">1</span>,   <span class="fl">0</span>,   <span class="fl">1</span><span class="op">)</span>,</span>
<span>                      <span class="st">"b"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,   <span class="fl">1.1</span>, <span class="fl">2.1</span>, <span class="fl">2</span>,   <span class="fl">0.1</span>, <span class="fl">1</span>,   <span class="fl">0.2</span><span class="op">)</span>,</span>
<span>                      <span class="st">"c"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>,  <span class="fl">11</span>,  <span class="fl">10</span>,  <span class="fl">11</span>,  <span class="fl">12</span>,  <span class="fl">9</span>,   <span class="fl">11</span><span class="op">)</span>,</span>
<span>                      <span class="st">"d"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,   <span class="fl">0</span>,   <span class="fl">0</span>,   <span class="fl">1</span>,   <span class="fl">1</span>,   <span class="fl">1</span>,   <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># For the interval case</span></span>
<span><span class="va">time1</span> <span class="op">&lt;-</span> <span class="st">"Starting_Age"</span></span>
<span><span class="va">time2</span> <span class="op">&lt;-</span> <span class="st">"Ending_Age"</span></span>
<span><span class="va">event</span> <span class="op">&lt;-</span> <span class="st">"Cancer_Status"</span></span>
<span></span>
<span><span class="co"># Supposing we had left truncated data the following would change</span></span>
<span><span class="va">time1</span> <span class="op">&lt;-</span> <span class="st">"Starting_Age"</span></span>
<span><span class="va">time2</span> <span class="op">&lt;-</span> <span class="st">"%trunc%"</span></span>
<span></span>
<span><span class="co"># and with right truncated data the following is used</span></span>
<span><span class="va">time1</span> <span class="op">&lt;-</span> <span class="st">"%trunc%"</span></span>
<span><span class="va">time2</span> <span class="op">&lt;-</span> <span class="st">"Ending_Age"</span></span>
<span></span>
<span><span class="co">#setting back to normal</span></span>
<span><span class="va">time1</span> <span class="op">&lt;-</span> <span class="st">"Starting_Age"</span></span>
<span><span class="va">time2</span> <span class="op">&lt;-</span> <span class="st">"Ending_Age"</span></span></code></pre></div>
<p>Suppose instead we were interested in a Poisson regression, the only
difference is instead of providing interval endpoints we give a column
of interval lengths. In this case we need to define a new column, but
that may not be the case in general. Suppose we are now working with the
following table:</p>
<table class="table">
<thead><tr class="header">
<th align="center">UserID</th>
<th align="center">Starting_Age</th>
<th align="center">Ending_Age</th>
<th align="center">Person_Years</th>
<th align="center">Cancer_Status</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">112</td>
<td align="center">18</td>
<td align="center">30</td>
<td align="center">12</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center">114</td>
<td align="center">20</td>
<td align="center">45</td>
<td align="center">25</td>
<td align="center">0</td>
</tr>
<tr class="odd">
<td align="center">213</td>
<td align="center">18</td>
<td align="center">57</td>
<td align="center">39</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">…</td>
<td align="center">…</td>
<td align="center">…</td>
<td align="center">…</td>
<td align="center">…</td>
</tr>
</tbody>
</table>
<p>we would just provide the duration column and event column, or
“Person_Years” and “Cancer_Status”. Which in code looks like the
following:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span><span class="op">$</span><span class="va">Person_Years</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">$</span><span class="va">Ending_Age</span> <span class="op">-</span><span class="va">df</span><span class="op">$</span><span class="va">Starting_Age</span></span>
<span><span class="va">pyr</span> <span class="op">&lt;-</span> <span class="st">"Person_Years"</span></span>
<span><span class="va">event</span> <span class="op">&lt;-</span> <span class="st">"Cancer_Status"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="control-and-verbosity">Control and Verbosity<a class="anchor" aria-label="anchor" href="#control-and-verbosity"></a>
</h2>
<p>Colossus offers several options that control how the input data is
used and returned. This can be split into two general categories. The
first category is convergence parameters. These cover the number of
iterations used, limits on parameter changes, and stopping criteria. The
second category is parameters used for debugging and additional
information. A more common option is the verbosity. The verbose mode
prints time-steps and intermediate values for the sum of terms, sum of
risks, and log-likelihood each iteration. A less common option is the
<em>der_iden</em> parameter, which is used change only one parameter at
a time by a set amount. This was used in the debugging process for
recording intermediate values on a plane. This option could be used by
the user in conjunction with the verbose option to plot intermediate
values by parameter value.</p>
<p>The convergence parameters currently supported in general are as
follows:</p>
<table class="table">
<colgroup>
<col width="47%">
<col width="52%">
</colgroup>
<thead><tr class="header">
<th align="center">Parameter</th>
<th align="center">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">lr</td>
<td align="center">learning rate applied to steps taken, smaller values
avoid overshooting at the risk of slower convergence. Applied to the
solution for setting first derivative of Log-Likelihood to zero</td>
</tr>
<tr class="even">
<td align="center">maxiter</td>
<td align="center">maximum number of iterations run</td>
</tr>
<tr class="odd">
<td align="center">maxiters</td>
<td align="center">list of maximum iterations if a list of initial
values is given</td>
</tr>
<tr class="even">
<td align="center">halfmax</td>
<td align="center">Maximum number of half-steps taken each
iteration</td>
</tr>
<tr class="odd">
<td align="center">epsilon</td>
<td align="center">Minimum parameter change above convergence. If change
is below this, the regression exits</td>
</tr>
<tr class="even">
<td align="center">dbeta_max</td>
<td align="center">learning rate applied to limit on steps taken.
Applied to solution to zero Log-Likelihood, for double_step=0</td>
</tr>
<tr class="odd">
<td align="center">deriv_epsilon</td>
<td align="center">Minimum Log-Likelihood first derivative above
convergence. If the largest first derivative is below this, the
regression exits</td>
</tr>
<tr class="even">
<td align="center">abs_max</td>
<td align="center">Largest starting step size. Code reduces it every
time halfmax is hit without finding an improvement. When abs_max is
below epsilon, the code exits</td>
</tr>
<tr class="odd">
<td align="center">dose_abs_max</td>
<td align="center">Largest starting step size for threshold parameters.
Assumes the threshold parameters may be orders of magnitude different
than other parameters</td>
</tr>
<tr class="even">
<td align="center">ties</td>
<td align="center">Allows for efron or breslow tie methods</td>
</tr>
<tr class="odd">
<td align="center">double_step</td>
<td align="center">Changes what step calculation method is used.
double_step=0 changes each parameter by the ratio of first to second
derivative independently. double_step=1 solves the system of equations
for all first and second derivatives</td>
</tr>
</tbody>
</table>
<p>The additional information parameters currently supported are as
follows:</p>
<table class="table">
<colgroup>
<col width="47%">
<col width="52%">
</colgroup>
<thead><tr class="header">
<th align="center">Parameter</th>
<th align="center">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">verbose</td>
<td align="center">TRUE/FALSE flag to print updates on parameter value
and which section of the code is active</td>
</tr>
<tr class="even">
<td align="center">change_all</td>
<td align="center">TRUE/FALSE flag to choose if the user wants a
regression or to calculate log-likelihoods on a grid changing only one
parameter at a time</td>
</tr>
<tr class="odd">
<td align="center">Ncores</td>
<td align="center">Number of physical cores assigned, cannot be greater
than the number of cores available</td>
</tr>
</tbody>
</table>
<p>The previous options are all contained within a list of parameters,
however there are additional standalone parameters which control the
convergence and information. They are as follows:</p>
<table class="table">
<colgroup>
<col width="47%">
<col width="52%">
</colgroup>
<thead><tr class="header">
<th align="center">Parameter</th>
<th align="center">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">der_iden</td>
<td align="center">If change_all is used, selects which parameter number
indexed from 0 to change. The parameter is changed by abs_max or
dose_abs_max every iteration over the maximum number of iterations</td>
</tr>
<tr class="even">
<td align="center">keep_constant</td>
<td align="center">a vector of 0/1 to denote if any parameters should be
held constant over the calculations. 0 denoting false and 1 denoting
true</td>
</tr>
</tbody>
</table>
<p>Going back to our example, the code may look like the following:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">keep_constant</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">der_iden</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span></span>
<span><span class="va">control</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Ncores"</span><span class="op">=</span><span class="fl">2</span>,<span class="st">'lr'</span> <span class="op">=</span> <span class="fl">0.75</span>,<span class="st">'maxiter'</span> <span class="op">=</span> <span class="fl">100</span>,<span class="st">'halfmax'</span> <span class="op">=</span> <span class="fl">5</span>,<span class="st">'epsilon'</span> <span class="op">=</span> <span class="fl">1e-9</span>,</span>
<span>             <span class="st">'dbeta_max'</span> <span class="op">=</span> <span class="fl">0.5</span>,<span class="st">'deriv_epsilon'</span> <span class="op">=</span> <span class="fl">1e-9</span>, <span class="st">'abs_max'</span><span class="op">=</span><span class="fl">1.0</span>,<span class="st">'change_all'</span><span class="op">=</span><span class="cn">TRUE</span>,</span>
<span>             <span class="st">'dose_abs_max'</span><span class="op">=</span><span class="fl">100.0</span>,<span class="st">'verbose'</span><span class="op">=</span><span class="cn">FALSE</span>, <span class="st">'ties'</span><span class="op">=</span><span class="st">'breslow'</span>,<span class="st">'double_step'</span><span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>In this example, no parameters are held constant, 100 iterations with
5 half-steps are used, a regression is performed with matrix step
solutions, and breslow’s method for tied event times is used. There are
no errors for unused control parameters being used, they will simply be
ignored. Every commonly required control parameter has a default value
which is automatically used if not declared. This includes an optional
list of model control options. These are used for nonstandard model
options not covered in this vignette.</p>
</div>
<div class="section level2">
<h2 id="running-the-regression-and-output">Running the Regression and Output<a class="anchor" aria-label="anchor" href="#running-the-regression-and-output"></a>
</h2>
<p>Finally the user calls the regression function they need. The names
used throughout this vignette are the defaults assumed. Both the Cox PH
regression and Poisson regression are called directly and return a list
of results. Colossus contains a suite of additional checks it runs on
the inputs prior to starting and calculations, which are designed to
output explicit details on any issues. Printing error details may
require the verbose option to be TRUE. In code the functions are called
as follows:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># assuming the table of covariates is stored in a data.table "df"</span></span>
<span></span>
<span><span class="va">e</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/RunCoxRegression.html">RunCoxRegression</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">time1</span>, <span class="va">time2</span>, <span class="va">event</span>, <span class="va">names</span>, <span class="va">Term_n</span>, <span class="va">tform</span>, <span class="va">keep_constant</span>,</span>
<span>                      <span class="va">a_n</span>, <span class="va">modelform</span>, <span class="va">fir</span>, <span class="va">der_iden</span>, <span class="va">control</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">e</span><span class="op">)</span></span>
<span><span class="co">#&gt; $LogLik</span></span>
<span><span class="co">#&gt; [1] -0.6753644</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $First_Der</span></span>
<span><span class="co">#&gt; [1] -2.220446e-16 -7.187040e-05  7.361232e-05  1.919948e-04</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Second_Der</span></span>
<span><span class="co">#&gt;              [,1]         [,2]          [,3]          [,4]</span></span>
<span><span class="co">#&gt; [1,] 2.220446e-16 2.710505e-20  1.734723e-18  3.559233e-18</span></span>
<span><span class="co">#&gt; [2,] 2.710505e-20 1.742209e-08  7.238366e-07  2.311365e-07</span></span>
<span><span class="co">#&gt; [3,] 1.734723e-18 7.238366e-07 -1.501037e-06 -2.356033e-07</span></span>
<span><span class="co">#&gt; [4,] 3.559233e-18 2.311365e-07 -2.356033e-07 -3.687577e-06</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $beta_0</span></span>
<span><span class="co">#&gt; [1]  42.97183  98.72266  96.82311 101.10000</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Standard_Deviation</span></span>
<span><span class="co">#&gt; [1]      NaN      NaN 240.8255 520.7003</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $AIC</span></span>
<span><span class="co">#&gt; [1] 9.350729</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Parameter_Lists</span></span>
<span><span class="co">#&gt; $Parameter_Lists$Term_n</span></span>
<span><span class="co">#&gt; [1] 0 1 1 2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Parameter_Lists$tforms</span></span>
<span><span class="co">#&gt; [1] "loglin" "lin"    "lin"    "plin"  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Parameter_Lists$names</span></span>
<span><span class="co">#&gt; [1] "a" "b" "c" "d"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Control_List</span></span>
<span><span class="co">#&gt; $Control_List$Iteration</span></span>
<span><span class="co">#&gt; [1] 100</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Control_List$`Maximum Step`</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Control_List$`Derivative Limiting`</span></span>
<span><span class="co">#&gt; [1] 0.0001919948</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Convgerged</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span></span>
<span><span class="co">#or a poisson regression</span></span>
<span><span class="va">a_n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span><span class="op">)</span> <span class="co">#a_n is updated when either regression is called</span></span>
<span><span class="va">e</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/RunPoissonRegression.html">RunPoissonRegression</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">pyr</span>, <span class="va">event</span>, <span class="va">names</span>, <span class="va">Term_n</span>, <span class="va">tform</span>, <span class="va">keep_constant</span>, <span class="va">a_n</span>,</span>
<span>                          <span class="va">modelform</span>, <span class="va">fir</span>, <span class="va">der_iden</span>, <span class="va">control</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">e</span><span class="op">)</span></span>
<span><span class="co">#&gt; $LogLik</span></span>
<span><span class="co">#&gt; [1] -44.73982</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $First_Der</span></span>
<span><span class="co">#&gt; [1]   -19.67462  -290.53655 -2314.56447   -19.64770</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Second_Der</span></span>
<span><span class="co">#&gt;              [,1]      [,2]        [,3]          [,4]</span></span>
<span><span class="co">#&gt; [1,]   -21.674624 -153.3672  -1393.0153    -4.8644043</span></span>
<span><span class="co">#&gt; [2,]  -153.367172 -108.7036   -666.9745  -101.9254174</span></span>
<span><span class="co">#&gt; [3,] -1393.015328 -666.9745 -21096.6437 -1058.8112374</span></span>
<span><span class="co">#&gt; [4,]    -4.864404 -101.9254  -1058.8112    -0.5929361</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $beta_0</span></span>
<span><span class="co">#&gt; [1] -0.40680015 -0.01846667 -0.07585910 -0.70133825</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Standard_Deviation</span></span>
<span><span class="co">#&gt; [1] 0.383529879 0.092209643 0.008136992 0.535536589</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $AIC</span></span>
<span><span class="co">#&gt; [1] 93.47964</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Deviation</span></span>
<span><span class="co">#&gt; [1] 85.47964</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Parameter_Lists</span></span>
<span><span class="co">#&gt; $Parameter_Lists$Term_n</span></span>
<span><span class="co">#&gt; [1] 0 1 1 2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Parameter_Lists$tforms</span></span>
<span><span class="co">#&gt; [1] "loglin" "lin"    "lin"    "plin"  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Parameter_Lists$names</span></span>
<span><span class="co">#&gt; [1] "a" "b" "c" "d"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Control_List</span></span>
<span><span class="co">#&gt; $Control_List$Iteration</span></span>
<span><span class="co">#&gt; [1] 12</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Control_List$`Maximum Step`</span></span>
<span><span class="co">#&gt; [1] 2.910383e-11</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Control_List$`Derivative Limiting`</span></span>
<span><span class="co">#&gt; [1] 2314.564</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Converged</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
<p>The following are output:</p>
<table class="table">
<colgroup>
<col width="47%">
<col width="52%">
</colgroup>
<thead><tr class="header">
<th align="center">Item</th>
<th align="center">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">LogLik</td>
<td align="center">Final Log-Likelihood</td>
</tr>
<tr class="even">
<td align="center">First_Der</td>
<td align="center">First derivative of Log-Likelihood at the final
point</td>
</tr>
<tr class="odd">
<td align="center">Second_Der</td>
<td align="center">Matrix of second derivatives of Log-Likelihood at the
final point</td>
</tr>
<tr class="even">
<td align="center">beta_0</td>
<td align="center">The final parameter list</td>
</tr>
<tr class="odd">
<td align="center">Standard_Deviation</td>
<td align="center">Inverse-Hessian estimate of the standard
deviation</td>
</tr>
<tr class="even">
<td align="center">AIC</td>
<td align="center">Akaike information criterion for the final
solution</td>
</tr>
<tr class="odd">
<td align="center">Deviation</td>
<td align="center">Deviance calculated using the difference in
log-likelihood contributions between the saturated model and current
model</td>
</tr>
<tr class="even">
<td align="center">Parameter_Lists</td>
<td align="center">the term numbers and term formulas used, to compare
against the expected</td>
</tr>
<tr class="odd">
<td align="center">Control_List</td>
<td align="center">a list containing the number of iterations, the
maximum step at the final iteration, and the highest first derivative
magnitude</td>
</tr>
<tr class="even">
<td align="center">Converged</td>
<td align="center">TRUE/FALSE if the regression converged</td>
</tr>
</tbody>
</table>
<p>For both cases, the regressions did not converge. Given that the
examples were arbitrary this is not unexpected. The Cox PH ran out of
iterations and did not decrease the step limit, so if it were restarted
at the new optimal guess it would be expected to continue converging.
The Poisson regression exited due to the step limit being below the
threshold, which means that it hit some local optimum. To find a better
solution the user would likely have to either change the model equation
or provide a new starting guess. This is an example of how to interpret
the results of a Colossus run.</p>
<p>There are additional variants of these functions which will be
described outside of this section. They return a similar list of
results.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Eric Giunta, NASA, NCRP, NRC.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
